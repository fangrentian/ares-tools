"use strict";const u=require("fs/promises"),a=require("os"),f=require("iconv-lite"),child_process=require("child_process"),utils_logger=require("./logger.cjs");function _interopDefaultCompat(e){return e&&typeof e=="object"&&"default"in e?e.default:e}const u__default=_interopDefaultCompat(u),a__default=_interopDefaultCompat(a),f__default=_interopDefaultCompat(f);async function renameDirectory(e,o){try{utils_logger.logger.info(`\u5F00\u59CB\u91CD\u547D\u540D\u6587\u4EF6\u5939: ${e} -> ${o}`),await u__default.rename(e,o),utils_logger.logger.info(`\u6587\u4EF6\u5939\u91CD\u547D\u540D\u5B8C\u6210: ${e} -> ${o}`)}catch(r){throw utils_logger.logger.error(`\u91CD\u547D\u540D\u6587\u4EF6\u5939\u5931\u8D25: ${e} -> ${o}`,r),r}}async function execCommand(e,o={}){return new Promise((r,i)=>{const c=a__default.platform()==="win32",s={cwd:process.cwd(),encoding:c?"buffer":"utf8",...o};try{utils_logger.logger.info(`\u6267\u884C\u547D\u4EE4 ${e}`),child_process.exec(e,s,function(d,t,n){c&&(Buffer.isBuffer(t)?t=f__default.decode(t,"GBK"):t=t.toString(),Buffer.isBuffer(n)?n=f__default.decode(n,"GBK"):n=n.toString()),utils_logger.logger.info(`\u6267\u884C\u547D\u4EE4 ${e} \u5B8C\u6210`),n&&utils_logger.logger.error(`\u6267\u884C\u547D\u4EE4 ${e} \u53D1\u751F\u5F02\u5E38`,n),r({stdout:t,stderr:n})})}catch(d){i(d)}})}async function execCDCommand(e){const o=`cd ${e}`;return execCommand(o)}async function execPNPMCommand(e,o){const r=`pnpm ${e}`;return execCommand(r,{cwd:o})}async function execProjectPNPMCommand(e,o){return execPNPMCommand(o,e)}async function execCommandUnderDirectory(e,o){return execCommand(o,{cwd:e})}async function spawnCommand(e,o=[],r={}){return new Promise((i,c)=>{const s=a__default.platform()==="win32",d={cwd:process.cwd(),shell:!0,...r};try{utils_logger.logger.info(`\u6267\u884C\u547D\u4EE4 ${e}`);const t=child_process.spawn(e,[...o],d);t.stdout.on("data",n=>{s&&(n=f__default.decode(n,"GBK")),console.info("stdout: ",n)}),t.stderr.on("data",n=>{s&&(n=f__default.decode(n,"GBK")),console.error("stderr: ",n),c(n)}),t.on("close",n=>{console.info(`child process exited with code ${n}`),i(`close with code ${n}`)})}catch(t){c(t)}})}async function spawnCDCommand(e){return spawnCommand("cd",[e])}async function spawnPNPMCommand(e,o){return spawnCommand("pnpm",[e],{cwd:o})}async function spawnProjectPNPMCommand(e,o){return execPNPMCommand(o,e)}async function spawnCommandUnderDirectory(e,o,r=[]){return spawnCommand(o,[...r],{cwd:e})}exports.execCDCommand=execCDCommand,exports.execCommand=execCommand,exports.execCommandUnderDirectory=execCommandUnderDirectory,exports.execPNPMCommand=execPNPMCommand,exports.execProjectPNPMCommand=execProjectPNPMCommand,exports.renameDirectory=renameDirectory,exports.spawnCDCommand=spawnCDCommand,exports.spawnCommand=spawnCommand,exports.spawnCommandUnderDirectory=spawnCommandUnderDirectory,exports.spawnPNPMCommand=spawnPNPMCommand,exports.spawnProjectPNPMCommand=spawnProjectPNPMCommand;
