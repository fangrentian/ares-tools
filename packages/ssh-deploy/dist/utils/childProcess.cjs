"use strict";const u=require("fs/promises"),a=require("os"),p=require("iconv-lite"),child_process=require("child_process"),utils_logger=require("./logger.cjs");function _interopDefaultCompat(e){return e&&typeof e=="object"&&"default"in e?e.default:e}const u__default=_interopDefaultCompat(u),a__default=_interopDefaultCompat(a),p__default=_interopDefaultCompat(p);async function renameDirectory(e,o){try{utils_logger.logger.info(`\u5F00\u59CB\u91CD\u547D\u540D\u6587\u4EF6\u5939: ${e} -> ${o}`),await u__default.rename(e,o),utils_logger.logger.info(`\u6587\u4EF6\u5939\u91CD\u547D\u540D\u5B8C\u6210: ${e} -> ${o}`)}catch(t){throw utils_logger.logger.error(`\u91CD\u547D\u540D\u6587\u4EF6\u5939\u5931\u8D25: ${e} -> ${o}`,t),t}}async function execCommand(e,o={}){return new Promise((t,d)=>{const s=a__default.platform()==="win32",i={cwd:process.cwd(),encoding:s?"buffer":"utf8",...o};try{utils_logger.logger.info(`\u5F00\u59CB\u6267\u884C\u547D\u4EE4 ${e}`),child_process.exec(e,i,function(c,r,n){if(s&&(Buffer.isBuffer(r)?r=p__default.decode(r,"GBK"):r=r.toString(),Buffer.isBuffer(n)?n=p__default.decode(n,"GBK"):n=n.toString()),c)return utils_logger.logger.error(`\u6267\u884C\u547D\u4EE4 ${e} \u53D1\u751F\u5F02\u5E38`,c),d(c);utils_logger.logger.info(`\u6267\u884C\u547D\u4EE4 ${e} \u5B8C\u6210`),console.info(`\u6267\u884C\u547D\u4EE4 ${e} STDOUT`,r),console.info(`\u6267\u884C\u547D\u4EE4 ${e} STDERR`,n),t({stdout:r,stderr:n})})}catch(c){d(c)}})}async function execCDCommand(e){const o=`cd ${e}`;return execCommand(o)}async function execPNPMCommand(e,o){const t=`pnpm ${e}`;return execCommand(t,{cwd:o})}async function execProjectPNPMCommand(e,o){return execPNPMCommand(o,e)}async function execCommandUnderDirectory(e,o){return execCommand(o,{cwd:e})}async function spawnCommand(e,o=[],t={}){return new Promise((d,s)=>{const i=a__default.platform()==="win32",c={cwd:process.cwd(),shell:!0,...t};try{utils_logger.logger.info(`\u5F00\u59CB\u6267\u884C\u547D\u4EE4 ${e}`);const r=child_process.spawn(e,[...o],c);r.stdout.on("data",n=>{i&&(n=p__default.decode(n,"GBK")),console.info("stdout: ",n)}),r.stderr.on("data",n=>{i&&(n=p__default.decode(n,"GBK")),console.error("stderr: ",n),s(n)}),r.on("close",n=>{console.info(`child process exited with code ${n}`),d(`close with code ${n}`)})}catch(r){s(r)}})}async function spawnCDCommand(e){return spawnCommand("cd",[e])}async function spawnPNPMCommand(e,o){return spawnCommand("pnpm",[e],{cwd:o})}async function spawnProjectPNPMCommand(e,o){return execPNPMCommand(o,e)}async function spawnCommandUnderDirectory(e,o,t=[]){return spawnCommand(o,[...t],{cwd:e})}exports.execCDCommand=execCDCommand,exports.execCommand=execCommand,exports.execCommandUnderDirectory=execCommandUnderDirectory,exports.execPNPMCommand=execPNPMCommand,exports.execProjectPNPMCommand=execProjectPNPMCommand,exports.renameDirectory=renameDirectory,exports.spawnCDCommand=spawnCDCommand,exports.spawnCommand=spawnCommand,exports.spawnCommandUnderDirectory=spawnCommandUnderDirectory,exports.spawnPNPMCommand=spawnPNPMCommand,exports.spawnProjectPNPMCommand=spawnProjectPNPMCommand;
