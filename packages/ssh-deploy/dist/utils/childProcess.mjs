import p from"fs/promises";import D from"os";import i from"iconv-lite";import{exec as w,spawn as y}from"child_process";import{logger as r}from"./logger.mjs";async function E(u,n){try{r.info(`\u5F00\u59CB\u91CD\u547D\u540D\u6587\u4EF6\u5939: ${u} -> ${n}`),await p.rename(u,n),r.info(`\u6587\u4EF6\u5939\u91CD\u547D\u540D\u5B8C\u6210: ${u} -> ${n}`)}catch(c){throw r.error(`\u91CD\u547D\u540D\u6587\u4EF6\u5939\u5931\u8D25: ${u} -> ${n}`,c),c}}async function m(u,n={}){return new Promise((c,d)=>{const s=D.platform()==="win32",a={cwd:process.cwd(),encoding:s?"buffer":"utf8",...n};try{r.info(`\u5F00\u59CB\u6267\u884C\u547D\u4EE4 ${u}`),w(u,a,function(t,e,o){if(s&&(Buffer.isBuffer(e)?e=i.decode(e,"GBK"):e=e.toString(),Buffer.isBuffer(o)?o=i.decode(o,"GBK"):o=o.toString()),t)return r.error(`\u6267\u884C\u547D\u4EE4 ${u} \u53D1\u751F\u5F02\u5E38`,t),d(t);r.info(`\u6267\u884C\u547D\u4EE4 ${u} \u5B8C\u6210`),console.info(`\u6267\u884C\u547D\u4EE4 ${u} STDOUT`,e),console.info(`\u6267\u884C\u547D\u4EE4 ${u} STDERR`,o),c({stdout:e,stderr:o})})}catch(t){d(t)}})}async function $(u){const n=`cd ${u}`;return m(n)}async function C(u,n){const c=`pnpm ${u}`;return m(c,{cwd:n})}async function l(u,n){return C(n,u)}async function B(u,n){return m(n,{cwd:u})}async function f(u,n=[],c={}){return new Promise((d,s)=>{const a=D.platform()==="win32",t={cwd:process.cwd(),shell:!0,...c};try{r.info(`\u5F00\u59CB\u6267\u884C\u547D\u4EE4 ${u}`);const e=y(u,[...n],t);e.stdout.on("data",o=>{a&&(o=i.decode(o,"GBK")),console.info("stdout: ",o)}),e.stderr.on("data",o=>{a&&(o=i.decode(o,"GBK")),console.error("stderr: ",o),s(o)}),e.on("close",o=>{console.info(`child process exited with code ${o}`),d(`close with code ${o}`)})}catch(e){s(e)}})}async function P(u){return f("cd",[u])}async function h(u,n){return f("pnpm",[u],{cwd:n})}async function x(u,n){return C(n,u)}async function F(u,n,c=[]){return f(n,[...c],{cwd:u})}export{$ as execCDCommand,m as execCommand,B as execCommandUnderDirectory,C as execPNPMCommand,l as execProjectPNPMCommand,E as renameDirectory,P as spawnCDCommand,f as spawnCommand,F as spawnCommandUnderDirectory,h as spawnPNPMCommand,x as spawnProjectPNPMCommand};
