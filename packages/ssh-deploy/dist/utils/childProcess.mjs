import p from"fs/promises";import C from"os";import i from"iconv-lite";import{exec as D,spawn as y}from"child_process";import{logger as t}from"./logger.mjs";async function $(n,o){try{t.info(`\u5F00\u59CB\u91CD\u547D\u540D\u6587\u4EF6\u5939: ${n} -> ${o}`),await p.rename(n,o),t.info(`\u6587\u4EF6\u5939\u91CD\u547D\u540D\u5B8C\u6210: ${n} -> ${o}`)}catch(e){throw t.error(`\u91CD\u547D\u540D\u6587\u4EF6\u5939\u5931\u8D25: ${n} -> ${o}`,e),e}}async function a(n,o={}){return new Promise((e,f)=>{const r=C.platform()==="win32",s={cwd:process.cwd(),encoding:r?"buffer":"utf8",...o};try{t.info(`\u6267\u884C\u547D\u4EE4 ${n}`),D(n,s,function(d,c,u){r&&(Buffer.isBuffer(c)?c=i.decode(c,"GBK"):c=c.toString(),Buffer.isBuffer(u)?u=i.decode(u,"GBK"):u=u.toString()),t.info(`\u6267\u884C\u547D\u4EE4 ${n} \u5B8C\u6210`),u&&t.error(`\u6267\u884C\u547D\u4EE4 ${n} \u53D1\u751F\u5F02\u5E38`,u),e({stdout:c,stderr:u})})}catch(d){f(d)}})}async function E(n){const o=`cd ${n}`;return a(o)}async function w(n,o){const e=`pnpm ${n}`;return a(e,{cwd:o})}async function P(n,o){return w(o,n)}async function l(n,o){return a(o,{cwd:n})}async function m(n,o=[],e={}){return new Promise((f,r)=>{const s=C.platform()==="win32",d={cwd:process.cwd(),shell:!0,...e};try{t.info(`\u6267\u884C\u547D\u4EE4 ${n}`);const c=y(n,[...o],d);c.stdout.on("data",u=>{s&&(u=i.decode(u,"GBK")),console.info("stdout: ",u)}),c.stderr.on("data",u=>{s&&(u=i.decode(u,"GBK")),console.error("stderr: ",u),r(u)}),c.on("close",u=>{console.info(`child process exited with code ${u}`),f(`close with code ${u}`)})}catch(c){r(c)}})}async function B(n){return m("cd",[n])}async function h(n,o){return m("pnpm",[n],{cwd:o})}async function x(n,o){return w(o,n)}async function F(n,o,e=[]){return m(o,[...e],{cwd:n})}export{E as execCDCommand,a as execCommand,l as execCommandUnderDirectory,w as execPNPMCommand,P as execProjectPNPMCommand,$ as renameDirectory,B as spawnCDCommand,m as spawnCommand,F as spawnCommandUnderDirectory,h as spawnPNPMCommand,x as spawnProjectPNPMCommand};
