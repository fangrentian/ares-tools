"use strict";const s=require("express"),c=require("cors"),config_router=require("./router.cjs"),utils_logger=require("../utils/logger.cjs");function _interopDefaultCompat(u){return u&&typeof u=="object"&&"default"in u?u.default:u}const s__default=_interopDefaultCompat(s),c__default=_interopDefaultCompat(c);async function run(u=3e3){const r=u||process.env.PORT||3e3,e=s__default();e.set("sseClients",new Map),e.set("wsClients",new Map),e.use(c__default()),e.use(s__default.json()),e.use(s__default.urlencoded({extended:!1})),config_router.useRoutes(e),e.listen(r,()=>{utils_logger.logger.log(`\u670D\u52A1\u5DF2\u5728 ${r} \u7AEF\u53E3\u8FD0\u884C`)}),process.on("uncaughtException",o=>{utils_logger.logger.error(`\u7CFB\u7EDF\u53D1\u751F\u672A\u6355\u83B7\u7684\u5F02\u5E38: ${o}`)}),process.on("unhandledRejection",(o,t)=>{utils_logger.logger.error(`\u7CFB\u7EDF\u53D1\u751F\u672A\u5904\u7406\u7684\u62D2\u7EDD: ${t} \u539F\u56E0\u662F: ${o}`)})}exports.run=run;
