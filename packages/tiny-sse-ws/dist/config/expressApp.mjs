import o from"express";import F from"cors";import{useRoutes as c}from"./router.mjs";import{logger as s}from"../utils/logger.mjs";async function p(r=3e3){const n=r||process.env.PORT||3e3,u=o();u.set("sseClients",new Map),u.set("wsClients",new Map),u.use(F()),u.use(o.json()),u.use(o.urlencoded({extended:!1})),c(u),u.listen(n,()=>{s.log(`\u670D\u52A1\u5DF2\u5728 ${n} \u7AEF\u53E3\u8FD0\u884C`)}),process.on("uncaughtException",e=>{s.error(`\u7CFB\u7EDF\u53D1\u751F\u672A\u6355\u83B7\u7684\u5F02\u5E38: ${e}`)}),process.on("unhandledRejection",(e,t)=>{s.error(`\u7CFB\u7EDF\u53D1\u751F\u672A\u5904\u7406\u7684\u62D2\u7EDD: ${t} \u539F\u56E0\u662F: ${e}`)})}export{p as run};
