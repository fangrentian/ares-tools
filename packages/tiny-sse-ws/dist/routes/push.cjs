"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const s=require("express"),config_Result=require("../config/Result.cjs"),utils_index=require("../utils/index.cjs"),routes_ws=require("./ws.cjs"),routes_sse=require("./sse.cjs");function _interopDefaultCompat(u){return u&&typeof u=="object"&&"default"in u?u.default:u}const s__default=_interopDefaultCompat(s),d=s__default.Router();let n;d.post("/sse",(u,t)=>{n||(n=new utils_index.AppMapUtil(u.app));const e=u.body.sessionId,c=u.body.data,o=n.getSseClient(e);if(o)try{routes_sse.sendSseEvent(e,o,c),t.send(config_Result.Result.success(`\u53D1\u9001 SSE \u6D88\u606F\u5230 ${e} \u6210\u529F`))}catch(r){console.error(`\u53D1\u9001 SSE \u6D88\u606F\u5230 ${e} \u5931\u8D25:`,r),t.status(500).send(config_Result.Result.fail(`\u53D1\u9001 SSE \u6D88\u606F\u5230 ${e} \u5931\u8D25`))}else t.status(500).send(config_Result.Result.fail("SSE \u5BA2\u6237\u7AEF\u4E0D\u5B58\u5728"))}),d.post("/sse-broadcast",(u,t)=>{n||(n=new utils_index.AppMapUtil(u.app));const e=n.getSseClients(),c=[];for(const[o,r]of e)try{routes_sse.sendSseEvent(o,r,u.body.data)}catch(l){console.error(`\u53D1\u9001 SSE \u6D88\u606F\u5230 ${o} \u5931\u8D25:`,l),c.push(o)}c.length>0?t.send(config_Result.Result.fail(c,"\u5E7F\u64AD SSE \u6D88\u606F\u5931\u8D25\u7684\u4F1A\u8BDDID\u5217\u8868")):t.send(config_Result.Result.success("\u5E7F\u64AD SSE \u6D88\u606F\u6210\u529F"))}),d.post("/ws",(u,t)=>{n||(n=new utils_index.AppMapUtil(u.app));const e=u.body.sessionId,c=u.body.data,o=n.getWsClient(e);if(o)try{routes_ws.sendWsEvent(e,o,c),t.send(config_Result.Result.success(`\u53D1\u9001 WEBSOCKET \u6D88\u606F\u5230 ${e} \u6210\u529F`))}catch(r){console.error(`\u53D1\u9001 WEBSOCKET \u6D88\u606F\u5230 ${e} \u5931\u8D25:`,r),t.send(config_Result.Result.fail(`\u53D1\u9001 WEBSOCKET \u6D88\u606F\u5230 ${e} \u5931\u8D25`))}else t.send(config_Result.Result.fail("WEBSOCKET \u5BA2\u6237\u7AEF\u4E0D\u5B58\u5728"))}),d.post("/ws-broadcast",(u,t)=>{n||(n=new utils_index.AppMapUtil(u.app));const e=n.getWsClients(),c=[];for(const[o,r]of e)try{routes_ws.sendWsEvent(o,r,u.body.data)}catch(l){console.error(`\u53D1\u9001 WEBSOCKET \u6D88\u606F\u5230 ${o} \u5931\u8D25:`,l),c.push(o)}c.length>0?t.send(config_Result.Result.fail(c,"\u5E7F\u64AD WEBSOCKET \u6D88\u606F\u5931\u8D25\u7684\u4F1A\u8BDDID\u5217\u8868")):t.send(config_Result.Result.success("\u5E7F\u64AD WEBSOCKET \u6D88\u606F\u6210\u529F"))}),exports.default=d;
