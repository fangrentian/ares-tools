import i from"express";import{Result as S}from"../config/Result.mjs";import{logger as s}from"../utils/logger.mjs";import{AppMapUtil as l}from"../utils/index.mjs";const n=(o,u,e)=>{try{u&&u.write(`data: ${JSON.stringify(S.success(e))}

`)}catch(F){s.error(`\u63A8\u9001 SSE \u6D88\u606F\u5230 ${o} \u5931\u8D25`,F)}},r=i.Router();let t;r.get("/connect",(o,u)=>{t||(t=new l(o.app));const e=o.sessionID;u.setHeader("Content-Type","text/event-stream; charset=utf-8"),u.setHeader("Cache-Control","no-cache"),u.setHeader("Connection","keep-alive"),u.flushHeaders(),t.addSseClient(e,u),s.log(`SSE \u5BA2\u6237\u7AEF\u5DF2\u8FDE\u63A5\uFF0CsessionID: ${e}\uFF0C\u5F53\u524D SSE \u5BA2\u6237\u7AEF\u603B\u6570: ${t.getSseClientCount()}`),n(e,u,`Hello, SSE! sessionID: ${e}`),o.on("close",()=>{s.log("SSE \u5BA2\u6237\u7AEF\u65AD\u5F00\u8FDE\u63A5\uFF0CsessionID:",e),t.removeSseClient(e),s.log(`SSE \u5BA2\u6237\u7AEF\u5DF2\u79FB\u9664\uFF0CsessionID: ${e}\uFF0C\u5F53\u524D SSE \u5BA2\u6237\u7AEF\u603B\u6570: ${t.getSseClientCount()}`),u.end()})});export{r as default,n as sendSseEvent};
