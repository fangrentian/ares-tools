"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const s=require("express"),config_Result=require("../config/Result.cjs"),utils_logger=require("../utils/logger.cjs"),utils_index=require("../utils/index.cjs");function _interopDefaultCompat(e){return e&&typeof e=="object"&&"default"in e?e.default:e}const s__default=_interopDefaultCompat(s),sendSseEvent=(e,u,t)=>{try{u&&u.write(`data: ${JSON.stringify(config_Result.Result.success(t))}

`)}catch(n){utils_logger.logger.error(`\u63A8\u9001 SSE \u6D88\u606F\u5230 ${e} \u5931\u8D25`,n)}},r=s__default.Router();let o;r.get("/connect",(e,u)=>{o||(o=new utils_index.AppMapUtil(e.app));const t=e.sessionID;u.setHeader("Content-Type","text/event-stream; charset=utf-8"),u.setHeader("Cache-Control","no-cache"),u.setHeader("Connection","keep-alive"),u.flushHeaders(),o.addSseClient(t,u),utils_logger.logger.log(`SSE \u5BA2\u6237\u7AEF\u5DF2\u8FDE\u63A5\uFF0CsessionID: ${t}\uFF0C\u5F53\u524D SSE \u5BA2\u6237\u7AEF\u603B\u6570: ${o.getSseClientCount()}`),sendSseEvent(t,u,`Hello, SSE! sessionID: ${t}`),e.on("close",()=>{utils_logger.logger.log("SSE \u5BA2\u6237\u7AEF\u65AD\u5F00\u8FDE\u63A5\uFF0CsessionID:",t),o.removeSseClient(t),utils_logger.logger.log(`SSE \u5BA2\u6237\u7AEF\u5DF2\u79FB\u9664\uFF0CsessionID: ${t}\uFF0C\u5F53\u524D SSE \u5BA2\u6237\u7AEF\u603B\u6570: ${o.getSseClientCount()}`),u.end()})}),exports.default=r,exports.sendSseEvent=sendSseEvent;
